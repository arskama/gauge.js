<!DOCTYPE html>
<html>
<head>
  <title>metrics_gauje.js</title>
  <meta name="description" content="100% native and cool looking animated JavaScript gauge">
  <meta name="viewport" content="width=1024, maximum-scale=1">
  <link rel="shortcut icon" href="favicon.ico">
  <meta http-equiv="X-UA-Compatible" content="IE=EDGE" />
  <link href="assets/bootstrap.min.css" type="text/css" rel="stylesheet">
  <link href="assets/main.css?v=5" type="text/css" rel="stylesheet">
  <link href='http://fonts.googleapis.com/css?family=Amaranth:400,700|Just+Another+Hand' rel='stylesheet' type='text/css'>
  <link href="assets/prettify.css" type="text/css" rel="stylesheet">
  <script type="text/javascript" src="assets/prettify.js"></script>
  <script type="text/javascript" src="assets/jscolor.js"></script>
 <!--[if lt IE 9]><script type="text/javascript" src="assets/excanvas.compiled.js"></script><![endif]-->
</head>
<style>

body, html {
  width: 100%;
  height: 100%;
  margin: 0px;
}

.container {
  width: 100%;
  height: 100%;
}

.leftpane {
  width: 50%;
  height: 50%;
  float: left;
  border-collapse: collapse;
}

.rightpane {
  width: 50%;
  height: 50%;
  position: relative;
  float: right;
  border-collapse: collapse;
}

.toppane {
  width: 100%;
  height: 100px;
  text-align: center;
  border-collapse: collapse;
}
.bigFont {
  font-size: 30px;
  font-weight: bold;
}
</style>

<body>
<divi class="toppane">
  <h2 id='CPSupport'></h2>
  <p>
    <button id="start-button">Start observing</button>
    <button id="stop-button">Stop observing</button>
  </p>
</div>
<!--<div id="content"> -->
  <div id="metric_a" class="leftpane">
    <h2>CPU Speed</h2>
    <div id="metric_a">
      <div id="metric_a-textfield" class="bigFont"></div>
      <canvas width=400 height=200 id="canvas_metric_a"></canvas>
    </div>
  </div>
  <div id="metric_b" class="rightpane">
    <h2>CPU Utilization</h2>
    <div id="metric_b">
      <div id="metric_b-textfield" class="bigFont"></div>
      <canvas width=400 height=200 id="canvas_metric_b"></canvas>
    </div>
  </div>
  <div id="metric_c" class="leftpane">
    <h2>CPU Latency (CPI)</h2>
    <div id="metric_c">
      <div id="metric_c-textfield" class="bigFont"></div>
      <canvas width=400 height=200 id="canvas_metric_c"></canvas>
    </div>
  </div>
  <div id="metric_d" class="rightpane">
    <h2>Renderi/3D Eng. Utilization</h2>
    <div id="metric_d">
      <div id="metric_d-textfield" class="bigFont"></div>
      <canvas width=400 height=200 id="canvas_metric_d"></canvas>
    </div>
  </div>
  <!--</div> <!--content--> -->
<script src="dist/gauge.js"></script>


<script type="text/javascript">
if('ComputePressureObserver' in window) {

  document.getElementById('CPSupport').innerHTML = 'Compute Pressure API available';

    function computePressureCallback(update) {
      console.log("cpu speed: " + update.cpuSpeed);
      console.log("cpu utils: " + update.cpuUtilization);
      console.log("cpu latency: " + update.cpuLatency);
      console.log("gpu render busy: " + update.gpuRenderBusy);

      gauge_a.set(update.cpuSpeed * 100);
      gauge_b.set(update.cpuUtilization * 100);
      if (update.cpuLatency < 0)
        update.cpuLatency = 0;
      if (update.cpuLatency > 4)
        update.cpuLatency = 4;
      gauge_c.set(update.cpuLatency);
      gauge_d.set(update.gpuRenderBusy);
    }

    let cpuUtilizationThresholds = [0.4, 0.6, 0.8];
    let cpuSpeedThresholds= [0.5];

        // Used by "Start observing" and "Stop observing" buttons.
      let observer = null;

      const startButton = document.getElementById("start-button");
      startButton.addEventListener("click", () => {
        observer = new ComputePressureObserver(
        computePressureCallback,
        {
          cpuUtilizationThresholds: cpuUtilizationThresholds,  //Only 3 threshold allowed
          cpuSpeedThresholds: cpuSpeedThresholds,                  //Only 1 threshold allowed
        });
        observer.observe();
      });

      const stopButton = document.getElementById("stop-button");
      stopButton.addEventListener("click", () => {
        if (observer !== null) observer.stop();
        gauge_b.set(0); // set actual value
        gauge_a.set(0); // set actual value
        gauge_c.set(0); // set actual value
        gauge_d.set(0); // set actual value


        // Intentionally not setting `observer` to null so we can manually test that
        // stop() is idempotent.
      });


var bigFont = "20px sans-serif";
var opts_a = {
  angle: 0.0, /// The span of the gauge arc
  lineWidth: 0.2, // The line thickness
  radiusScale: 0.9,
  fontSize: 0.2,
  pointer: {
    length: 0.6, // Relative to gauge radius
    strokeWidth: 0.05 // The thickness
  },
  renderTicks: {
          divisions: 10,
          divWidth: 1.1,
          divLength: 0.7,
          divColor: "#333333",
          //subDivisions: 2,
          //subLength: 0.2,
          //subWidth: 0.6,
          //subColor: "#666666",
  },
  staticLabels: {
    font: "10px sans-serif",  // Specifies font
    labels: [{label: 0, font: bigFont},
             {label:(cpuSpeedThresholds[0]*100), font: bigFont},
             {label:100, font: bigFont},
             /*{label:20, font: bigFont},
             {label:30, font: bigFont},
             {label:40, font: bigFont},
             {label:50, font: bigFont},
             {label:60, font: bigFont},
             {label:70, font: bigFont},
             {label:80, font: bigFont},
             {label:90, font: bigFont},
             {label:100, font: bigFont}*/],

    color: "#000000",  // Optional: Label text color
    fractionDigits: 0  // Optional: Numerical precision. 0=round off.
  },
  strokeColor: '#E0E0E0',   // to see which ones work best for you
//  staticZones: [
//    {strokeStyle: "#30B32D", min: 0, max: 60}, // Red from 100 to 130
//    {strokeStyle: "#FFDD00", min: 60, max: 90}, // Yellow
//    {strokeStyle: "#F03E3E", min: 90, max: 100}, // Green
//  ],
  generateGradient: true,
};
var target_a = document.getElementById('canvas_metric_a'); // your canvas element
var gauge_a = new Gauge(target_a).setOptions(opts_a); // create sexy gauge!
gauge_a.setTextField(document.getElementById("metric_a-textfield"));
gauge_a.maxValue = 100; // set max gauge value
gauge_a.MinValue = 0;  // set min value
gauge_a.animationSpeed = 1;
gauge_a.set(0); // set actual value

var opts_b = {
  angle: 0.0, /// The span of the gauge arc
  lineWidth: 0.2, // The line thickness
  radiusScale: 0.9,
  fontSize: 0.2,
  pointer: {
    length: 0.6, // Relative to gauge radius
    strokeWidth: 0.05 // The thickness
  },
  renderTicks: {
          divisions: 10,
          divWidth: 1.1,
          divLength: 0.7,
          divColor: "#333333",
          //subDivisions: 2,
          //subLength: 0.2,
          //subWidth: 0.6,
          //subColor: "#666666",
  },
  staticLabels: {
    font: "10px sans-serif",  // Specifies font
    labels: [{label: 0, font: bigFont},
             {label:(cpuUtilizationThresholds[0]*100), font: bigFont},
             {label:(cpuUtilizationThresholds[1]*100), font: bigFont},
             {label:(cpuUtilizationThresholds[2]*100), font: bigFont},
             {label:100, font: bigFont},
             /*{label:20, font: bigFont},
             {label:30, font: bigFont},
             {label:40, font: bigFont},
             {label:50, font: bigFont},
             {label:60, font: bigFont},
             {label:70, font: bigFont},
             {label:80, font: bigFont},
             {label:90, font: bigFont},
             {label:100, font: bigFont}*/],

    color: "#000000",  // Optional: Label text color
    fractionDigits: 0  // Optional: Numerical precision. 0=round off.
  },
  strokeColor: '#E0E0E0',   // to see which ones work best for you
//  staticZones: [
//    {strokeStyle: "#30B32D", min: 0, max: 60}, // Red from 100 to 130
//    {strokeStyle: "#FFDD00", min: 60, max: 90}, // Yellow
//    {strokeStyle: "#F03E3E", min: 90, max: 100}, // Green
//  ],
  generateGradient: true,
};
var target_b = document.getElementById('canvas_metric_b'); // your canvas element
var gauge_b = new Gauge(target_b).setOptions(opts_b); // create sexy gauge!
gauge_b.setTextField(document.getElementById("metric_b-textfield"));
gauge_b.maxValue = 100; // set max gauge value
gauge_b.MinValue = 0;  // set min value
gauge_b.set(0); // set actual value
gauge_b.animationSpeed = 1;

var opts_c = {
  angle: 0.0, /// The span of the gauge arc
  lineWidth: 0.2, // The line thickness
  radiusScale: 0.9,
  fontSize: 0.2,
  pointer: {
    length: 0.6, // Relative to gauge radius
    strokeWidth: 0.05 // The thickness
  },
  renderTicks: {
          divisions: 4,
          divWidth: 1.1,
          divLength: 0.7,
          divColor: "#333333",
          //subDivisions: 2,
          //subLength: 0.2,
          //subWidth: 0.6,
          //subColor: "#666666",
  },
  staticLabels: {
    font: "10px sans-serif",  // Specifies font
    labels: [{label: 0, font: bigFont},
             {label:1, font: bigFont},
             {label:2, font: bigFont},
             {label:3, font: bigFont},
             {label:4, font: bigFont},
             /*{label:20, font: bigFont},
             {label:30, font: bigFont},
             {label:40, font: bigFont},
             {label:50, font: bigFont},
             {label:60, font: bigFont},
             {label:70, font: bigFont},
             {label:80, font: bigFont},
             {label:90, font: bigFont},
             {label:100, font: bigFont}*/],

    color: "#000000",  // Optional: Label text color
    fractionDigits: 0  // Optional: Numerical precision. 0=round off.
  },
  strokeColor: '#E0E0E0',   // to see which ones work best for you
//  staticZones: [
//    {strokeStyle: "#30B32D", min: 0, max: 60}, // Red from 100 to 130
//    {strokeStyle: "#FFDD00", min: 60, max: 90}, // Yellow
//    {strokeStyle: "#F03E3E", min: 90, max: 100}, // Green
//  ],
  generateGradient: true,
};
var target_c = document.getElementById('canvas_metric_c'); // your canvas element
var gauge_c = new Gauge(target_c).setOptions(opts_c); // create sexy gauge!
gauge_c.setTextField(document.getElementById("metric_c-textfield"), 2);
gauge_c.maxValue = 4; // set max gauge value
gauge_c.MinValue = 0;  // set min value
gauge_c.set(0); // set actual value
gauge_c.animationSpeed = 1;

var target_d = document.getElementById('canvas_metric_d'); // your canvas element
var gauge_d = new Gauge(target_d).setOptions(opts_b); // create sexy gauge!
gauge_d.setTextField(document.getElementById("metric_d-textfield"));
gauge_d.maxValue = 100; // set max gauge value
gauge_d.MinValue = 0;  // set min value
gauge_d.set(0); // set actual value
gauge_d.animationSpeed = 1;
}else{
  document.getElementById('CPSupport').innerText = 'Compute Pressure NOT available';
}
</script>
